<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Centers Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-sidebar-v2@3.0.0/css/leaflet-sidebar.min.css">
    <style>
        #map { height: 100vh; }
        .legend { background: white; padding: 10px; border-radius: 5px; line-height: 1.5; }
        .custom-marker { width: 24px; height: 24px; border-radius: 50%; background-size: cover; }
        .leaflet-control-northarrow { background-image: url('icons/north-arrow.svg'); background-size: cover; width: 32px; height: 32px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-sidebar-v2@3.0.0/js/leaflet-sidebar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.locatecontrol/0.72.0/L.Control.Locate.min.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-measure/2.3.0/leaflet-measure.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-fullscreen/1.5.0/Control.FullScreen.min.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script>
        var map = L.map('map').setView([31.9026, 35.1955], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var baseMaps = {
            "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }),
            "Stamen Watercolor": L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg', {
                attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under ODbL.'
            })
        };

        baseMaps["OpenStreetMap"].addTo(map);
        L.control.layers(baseMaps).addTo(map);

        var locateControl = L.control.locate({
            position: 'topright',
            drawCircle: true,
            follow: true,
            setView: true,
            keepCurrentZoomLevel: true,
            markerStyle: {
                weight: 1,
                opacity: 0.8,
                fillOpacity: 0.8
            },
            circleStyle: {
                weight: 1,
                clickable: false
            },
            icon: 'fa fa-location-arrow',
            metric: false,
            strings: {
                title: "My location",
                popup: "You are within {distance} {unit} from this point",
                outsideMapBoundsMsg: "You seem located outside the boundaries of the map"
            },
            locateOptions: {
                maxZoom: 19,
                watch: true,
                enableHighAccuracy: true,
                maximumAge: 10000,
                timeout: 10000
            }
        }).addTo(map);

        var legend = L.control({position: 'bottomright'});
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'legend');
            div.innerHTML += '<i class="fa-regular fa-hospital" style="color: red"></i><span>Hospitals</span><br>';
            div.innerHTML += '<i class="fa-duotone fa-truck-fire" style="color: yellow"></i><span>Civil Defense</span><br>';
            div.innerHTML += '<i class="fa-solid fa-mortar-pestle" style="color: green"></i><span>Pharmacies</span><br>';
            div.innerHTML += '<i class="fa-solid fa-user-police" style="color: blue"></i><span>Police</span><br>';
            return div;
        };
        legend.addTo(map);

        var sidebar = L.control.sidebar('sidebar').addTo(map);

        var northArrow = L.control({ position: 'topright' });
        northArrow.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'leaflet-control-northarrow');
            return div;
        };
        northArrow.addTo(map);

        // إعداد الألوان حسب النوع
        var typeColors = {
            hospital: 'red',
            civil: 'yellow',
            pharmacy: 'green',
            police: 'blue'
        };

        // إعداد مسار الرموز حسب النوع
        var typeIcon = {
            hospital: 'hospital',
            civil: 'ciivilld',
            pharmacy: 'pharmacy',
            police: 'police'
        };

        // إنشاء رمز مخصص لكل نوع
        function createCustomIcon(type) {
            const color = typeColors[type.toLowerCase()];
            const icon = typeIcon[type.toLowerCase()];
            const iconHtml = `<div><img src="icons/${icon}.svg" style="background-color:${color}; width: 24px; height: 24px; border-radius: 50%;"></div>`;
            return L.divIcon({
                className: 'custom-marker',
                html: iconHtml
            });
        }

        var hospitalLayer, civilLayer, pharmacyLayer, policeLayer, zoneLayer;

        fetch('hospital.geojson').then(res => res.json()).then(data => {
            hospitalLayer = L.geoJson(data, {
                onEachFeature: function (feature, layer) {
                    layer.bindPopup("<b>Hospital:</b> " + feature.properties.NAME_AR);
                },
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng, { icon: createCustomIcon('hospital') });
                }
            }).addTo(map);
        });

        fetch('civil.geojson').then(res => res.json()).then(data => {
            civilLayer = L.geoJson(data, {
                onEachFeature: function (feature, layer) {
                    layer.bindPopup("<b>Civil Defense:</b> " + feature.properties.Name);
                },
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng, { icon: createCustomIcon('civil') });
                }
            }).addTo(map);
        });

        fetch('pharmacy.geojson').then(res => res.json()).then(data => {
            pharmacyLayer = L.geoJson(data, {
                onEachFeature: function (feature, layer) {
                    layer.bindPopup("<b>Pharmacy:</b> " + feature.properties.NAME_AR);
                },
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng, { icon: createCustomIcon('pharmacy') });
                }
            }).addTo(map);
        });

        fetch('Police.geojson').then(res => res.json()).then(data => {
            policeLayer = L.geoJson(data, {
                onEachFeature: function (feature, layer) {
                    layer.bindPopup("<b>Police Station:</b> " + feature.properties.NAME_AR_1);
                },
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng, { icon: createCustomIcon('police') });
                }
            }).addTo(map);
        });

        fetch('RamallahZones.geojson').then(res => res.json()).then(data => {
            zoneLayer = L.geoJson(data, {
                style: function (feature) {
                    return {
                        color: "black",
                        weight: 1,
                        fillOpacity: 0.1
                    };
                },
                onEachFeature: function (feature, layer) {
                    layer.bindPopup("<b>Zone:</b> " + feature.properties.NAME + "<br><b>Mail Code:</b> " + feature.properties.MAIL_CODE);
                }
            }).addTo(map);
        });

        // أضف أزرار التبديل بين الطبقات
        var overlayMaps = {
            "Hospitals": hospitalLayer,
            "Civil Defense": civilLayer,
            "Pharmacies": pharmacyLayer,
            "Police": policeLayer,
            "Zones": zoneLayer
        };

        L.control.layers(null, overlayMaps).addTo(map);

        // أضف خاصية التوجيه
        L.Routing.control({
            waypoints: [
                L.latLng(31.9026, 35.1955)
            ],
            routeWhileDragging: true
        }).addTo(map);
    </script>
</body>
</html>
